---
title: "ks_processing_IB"
author: "Indra Boving"
date: "5/21/2022"
output: html_document
---

```{r setup, include=FALSE}
library(janitor)
library(here)
library(tidyverse)
library(lubridate)
library(readxl)
```

Read in data: 
```{r}
ks_data <- read_csv(here("data", "ks_data", "ks_alldates.csv")) %>% 
  clean_names() %>% 
  mutate(date = lubridate::mdy(date)) %>% 
  mutate(week = week(date)) %>% 
  mutate(tree = as.factor(tree)) %>% 
  mutate(alas = total_area/sapwood_area) 

dlookr::diagnose(ks_data)
```

```{r}
####### Water Potentials 
#Date: 228 WP + LWC
wpwc228 <- read_excel(here("Data_05042022","WP_WC", "SHIFT data collection 2022.xlsx"), sheet="228 WP + LWC", skip=5, na = "NA") %>% as.data.frame()

#Date: 38-311 WP + LWC
wpwc38 <- read_excel("Data_05042022/WP_WC/SHIFT data collection 2022.xlsx",sheet="38-311 WP + LWC", skip=5, na = "NA")
# remove mislabeled tree 2567 which was actually 2367 
wpwc38 <- wpwc38[-which(wpwc38$Tag=="2567"),]

#Date: 315 WP + LWC
wpwc315 <- read_excel("Data_05042022/WP_WC/SHIFT data collection 2022.xlsx",sheet="315 WP + LWC", skip=5, na = "NA")

#Date: 330 WP + LWC (core)
wpwc330 <- read_excel("Data_05042022/WP_WC/SHIFT data collection 2022.xlsx",sheet="330 WP + LWC", skip=5, na = "NA")

#Date: 411-412 WP + LWC (satellite)
wpwc44 <- read_excel("Data_05042022/WP_WC/SHIFT data collection 2022.xlsx",sheet="44 WP + LWC", skip=5, na = "NA")

#Date: 411-412 WP + LWC
wpwc411 <- read_excel("Data_05042022/WP_WC/SHIFT data collection 2022.xlsx",sheet="411-412 WP + LWC", skip=5, na = "NA")


```


Look at it!

```{r}
ks_data %>% 
ggplot(aes(y = kl_g_s_mm_m_pa_nat, x = date, color = tree)) +
  geom_point() + 
  stat_summary(fun.y="mean", geom="line", aes(group=factor(tree))) +
  ggtitle("Kleaf over time")
```

```{r}
ks_data %>% 
ggplot(aes(y = ks_g_s_mm_m_pa_nat, x = date, color = tree)) +
  geom_point()+ 
  stat_summary(fun.y="mean", geom="line", aes(group=factor(tree))) +
  ggtitle("Kstem over time")
```

```{r}
ks_data %>% 
  filter(plc > 0) %>% 
ggplot(aes(y = plc, x = date, color = tree)) +
  geom_point()+ 
  stat_summary(fun.y="mean", geom="line", aes(group=factor(tree))) +
  ggtitle("PLC over time")
```

```{r}
ks_data %>% 
  filter(plc > 0) %>% 
ggplot(aes(y = k_g_mm_s_m_pa_max, x = date, color = tree)) +
  geom_point()+ 
  stat_summary(fun.y="mean", geom="line", aes(group=factor(tree))) +
  ggtitle("Max flow over time")
```

```{r}
ks_data %>% 
  filter(plc > 0) %>% 
ggplot(aes(y = log(alas), x = k_g_mm_s_m_pa_nat, color = tree)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE)
```

```{r}
ks_data %>% 
  filter(plc > 0) %>% 
ggplot(aes(y = alas, x = k_g_mm_s_m_pa_nat, color = tree)) +
  geom_smooth(method = "lm", se = F) +
  geom_point() 
```